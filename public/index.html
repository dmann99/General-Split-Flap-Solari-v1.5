<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Split Flap Display</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="plugins/arrivals/custom.css">
</head>
<body>
    <!-- CURRENT TIME -->
    <div id="current-time" style="position: absolute; bottom: 25px; right: 25px; font-size: 30px; font-weight: bold;"></div>

    <!-- CONTAINER -->
    <div id="board" class="chartContainer splitflap">

        <!-- rows will be placed here dynamically from #row_template -->
    </div>
    <!-- END CONTAINER -->

    <!-- ROW TEMPLATE (will be generated dynamically) -->
    <script type="text/template" id="row_template">
    </script>
    <!-- END ROW TEMPLATE -->

    <!-- JS LIBRARIES -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>
    <script type="text/javascript" src="js/split-flap.js"></script>
    <script type="text/javascript" src="plugins/arrivals/custom.js"></script>

    <!-- CUSTOMIZATION OPTIONS AND SCRIPT INITIALIZATION -->
    <script type="text/javascript">
        $(document).ready(function() {
            // Fetch configuration first
            $.get('/api/config', function(config) {
                const numRows = config.rows || 10;
                const numColumns = config.columns || 40;

                // Generate row template dynamically based on columns
                let templateHTML = '<div class="row"><div class="group text">';
                for (let i = 0; i < numColumns; i++) {
                    templateHTML += '<div class="full"><span></span></div>';
                }
                templateHTML += '</div></div>';
                $('#row_template').html(templateHTML);

                // Initialize split flap with configuration
                sf.options = {
                    plugin: 'arrivals',
                    container: $('#board'),
                    template: $('#row_template'),
                    numRows: numRows,
                    sort: false,
                    order: 'asc',
                    maxResults: numRows,
                    pageInterval: 20000,
                    stagger: 300
                };

                sf.board.init(sf.options);
                sf.items.init(sf.options);
                sf.items.load(sf.options);
            });

            // Update the current time every second
            function updateTime() {
                const now = new Date();
                let hours = now.getHours();
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                const timeString = `${hours}:${minutes} ${ampm}`;
                $('#current-time').text(timeString);
            }

            setInterval(updateTime, 1000);
            updateTime();
        });
    </script>
</body>
</html>
